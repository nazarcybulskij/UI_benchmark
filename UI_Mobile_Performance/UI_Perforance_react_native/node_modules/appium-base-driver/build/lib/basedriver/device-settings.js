"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.BASEDRIVER_HANDLED_SETTINGS = exports.DeviceSettings = exports.default = void 0;

require("source-map-support/register");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _images = require("./commands/images");

var _imageElement = require("./image-element");

const GLOBAL_DEFAULT_SETTINGS = {
  imageMatchThreshold: _images.DEFAULT_MATCH_THRESHOLD,
  fixImageFindScreenshotDims: true,
  fixImageTemplateSize: false,
  fixImageTemplateScale: false,
  defaultImageTemplateScale: _imageElement.DEFAULT_TEMPLATE_IMAGE_SCALE,
  checkForImageElementStaleness: true,
  autoUpdateImageElementPosition: false,
  imageElementTapStrategy: _imageElement.IMAGE_EL_TAP_STRATEGY_W3C,
  getMatchedImageResult: false
};
const BASEDRIVER_HANDLED_SETTINGS = ['imageMatchThreshold', 'fixImageFindScreenshotDims', 'fixImageTemplateSize', 'fixImageTemplateScale', 'defaultImageTemplateScale', 'checkForImageElementStaleness', 'autoUpdateImageElementPosition', 'imageElementTapStrategy', 'getMatchedImageResult'];
exports.BASEDRIVER_HANDLED_SETTINGS = BASEDRIVER_HANDLED_SETTINGS;

class DeviceSettings {
  constructor(defaultSettings = {}, onSettingsUpdate = null) {
    this._settings = Object.assign({}, GLOBAL_DEFAULT_SETTINGS, defaultSettings);
    this.onSettingsUpdate = onSettingsUpdate;
  }

  async update(newSettings) {
    if (!_lodash.default.isPlainObject(newSettings)) {
      throw new Error(`Settings update should be called with valid JSON. Got ` + `${JSON.stringify(newSettings)} instead`);
    }

    for (const prop of _lodash.default.keys(newSettings)) {
      if (!_lodash.default.isUndefined(this._settings[prop])) {
        if (this._settings[prop] === newSettings[prop]) {
          _logger.default.debug(`The value of '${prop}' setting did not change. Skipping the update for it`);

          continue;
        }
      }

      if (_lodash.default.isFunction(this.onSettingsUpdate)) {
        await this.onSettingsUpdate(prop, newSettings[prop], this._settings[prop]);
        this._settings[prop] = newSettings[prop];
      } else {
        _logger.default.errorAndThrow(`Unable to update settings; ` + `onSettingsUpdate method not found on '${this.constructor.name}'`);
      }
    }
  }

  getSettings() {
    return this._settings;
  }

}

exports.DeviceSettings = DeviceSettings;
var _default = DeviceSettings;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9iYXNlZHJpdmVyL2RldmljZS1zZXR0aW5ncy5qcyJdLCJuYW1lcyI6WyJHTE9CQUxfREVGQVVMVF9TRVRUSU5HUyIsImltYWdlTWF0Y2hUaHJlc2hvbGQiLCJERUZBVUxUX01BVENIX1RIUkVTSE9MRCIsImZpeEltYWdlRmluZFNjcmVlbnNob3REaW1zIiwiZml4SW1hZ2VUZW1wbGF0ZVNpemUiLCJmaXhJbWFnZVRlbXBsYXRlU2NhbGUiLCJkZWZhdWx0SW1hZ2VUZW1wbGF0ZVNjYWxlIiwiREVGQVVMVF9URU1QTEFURV9JTUFHRV9TQ0FMRSIsImNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzIiwiYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uIiwiaW1hZ2VFbGVtZW50VGFwU3RyYXRlZ3kiLCJJTUFHRV9FTF9UQVBfU1RSQVRFR1lfVzNDIiwiZ2V0TWF0Y2hlZEltYWdlUmVzdWx0IiwiQkFTRURSSVZFUl9IQU5ETEVEX1NFVFRJTkdTIiwiRGV2aWNlU2V0dGluZ3MiLCJjb25zdHJ1Y3RvciIsImRlZmF1bHRTZXR0aW5ncyIsIm9uU2V0dGluZ3NVcGRhdGUiLCJfc2V0dGluZ3MiLCJPYmplY3QiLCJhc3NpZ24iLCJ1cGRhdGUiLCJuZXdTZXR0aW5ncyIsIl8iLCJpc1BsYWluT2JqZWN0IiwiRXJyb3IiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvcCIsImtleXMiLCJpc1VuZGVmaW5lZCIsImxvZyIsImRlYnVnIiwiaXNGdW5jdGlvbiIsImVycm9yQW5kVGhyb3ciLCJuYW1lIiwiZ2V0U2V0dGluZ3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsdUJBQXVCLEdBQUc7QUFHOUJDLEVBQUFBLG1CQUFtQixFQUFFQywrQkFIUztBQU85QkMsRUFBQUEsMEJBQTBCLEVBQUUsSUFQRTtBQVk5QkMsRUFBQUEsb0JBQW9CLEVBQUUsS0FaUTtBQW9COUJDLEVBQUFBLHFCQUFxQixFQUFFLEtBcEJPO0FBNEI5QkMsRUFBQUEseUJBQXlCLEVBQUVDLDBDQTVCRztBQWdDOUJDLEVBQUFBLDZCQUE2QixFQUFFLElBaENEO0FBb0M5QkMsRUFBQUEsOEJBQThCLEVBQUUsS0FwQ0Y7QUF3QzlCQyxFQUFBQSx1QkFBdUIsRUFBRUMsdUNBeENLO0FBNEM5QkMsRUFBQUEscUJBQXFCLEVBQUU7QUE1Q08sQ0FBaEM7QUFpREEsTUFBTUMsMkJBQTJCLEdBQUcsQ0FDbEMscUJBRGtDLEVBRWxDLDRCQUZrQyxFQUdsQyxzQkFIa0MsRUFJbEMsdUJBSmtDLEVBS2xDLDJCQUxrQyxFQU1sQywrQkFOa0MsRUFPbEMsZ0NBUGtDLEVBUWxDLHlCQVJrQyxFQVNsQyx1QkFUa0MsQ0FBcEM7OztBQVlBLE1BQU1DLGNBQU4sQ0FBcUI7QUFFbkJDLEVBQUFBLFdBQVcsQ0FBRUMsZUFBZSxHQUFHLEVBQXBCLEVBQXdCQyxnQkFBZ0IsR0FBRyxJQUEzQyxFQUFpRDtBQUMxRCxTQUFLQyxTQUFMLEdBQWlCQyxNQUFNLENBQUNDLE1BQVAsQ0FBYyxFQUFkLEVBQWtCcEIsdUJBQWxCLEVBQTJDZ0IsZUFBM0MsQ0FBakI7QUFDQSxTQUFLQyxnQkFBTCxHQUF3QkEsZ0JBQXhCO0FBQ0Q7O0FBR0QsUUFBTUksTUFBTixDQUFjQyxXQUFkLEVBQTJCO0FBQ3pCLFFBQUksQ0FBQ0MsZ0JBQUVDLGFBQUYsQ0FBZ0JGLFdBQWhCLENBQUwsRUFBbUM7QUFDakMsWUFBTSxJQUFJRyxLQUFKLENBQVcsd0RBQUQsR0FDYixHQUFFQyxJQUFJLENBQUNDLFNBQUwsQ0FBZUwsV0FBZixDQUE0QixVQUQzQixDQUFOO0FBRUQ7O0FBQ0QsU0FBSyxNQUFNTSxJQUFYLElBQW1CTCxnQkFBRU0sSUFBRixDQUFPUCxXQUFQLENBQW5CLEVBQXdDO0FBQ3RDLFVBQUksQ0FBQ0MsZ0JBQUVPLFdBQUYsQ0FBYyxLQUFLWixTQUFMLENBQWVVLElBQWYsQ0FBZCxDQUFMLEVBQTBDO0FBQ3hDLFlBQUksS0FBS1YsU0FBTCxDQUFlVSxJQUFmLE1BQXlCTixXQUFXLENBQUNNLElBQUQsQ0FBeEMsRUFBZ0Q7QUFDOUNHLDBCQUFJQyxLQUFKLENBQVcsaUJBQWdCSixJQUFLLHNEQUFoQzs7QUFDQTtBQUNEO0FBQ0Y7O0FBRUQsVUFBSUwsZ0JBQUVVLFVBQUYsQ0FBYSxLQUFLaEIsZ0JBQWxCLENBQUosRUFBeUM7QUFDdkMsY0FBTSxLQUFLQSxnQkFBTCxDQUFzQlcsSUFBdEIsRUFBNEJOLFdBQVcsQ0FBQ00sSUFBRCxDQUF2QyxFQUErQyxLQUFLVixTQUFMLENBQWVVLElBQWYsQ0FBL0MsQ0FBTjtBQUNBLGFBQUtWLFNBQUwsQ0FBZVUsSUFBZixJQUF1Qk4sV0FBVyxDQUFDTSxJQUFELENBQWxDO0FBQ0QsT0FIRCxNQUdPO0FBQ0xHLHdCQUFJRyxhQUFKLENBQW1CLDZCQUFELEdBQ2YseUNBQXdDLEtBQUtuQixXQUFMLENBQWlCb0IsSUFBSyxHQURqRTtBQUVEO0FBQ0Y7QUFDRjs7QUFFREMsRUFBQUEsV0FBVyxHQUFJO0FBQ2IsV0FBTyxLQUFLbEIsU0FBWjtBQUNEOztBQWpDa0I7OztlQW9DTkosYyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCB7IERFRkFVTFRfTUFUQ0hfVEhSRVNIT0xEIH0gZnJvbSAnLi9jb21tYW5kcy9pbWFnZXMnO1xuaW1wb3J0IHsgSU1BR0VfRUxfVEFQX1NUUkFURUdZX1czQywgREVGQVVMVF9URU1QTEFURV9JTUFHRV9TQ0FMRSB9IGZyb20gJy4vaW1hZ2UtZWxlbWVudCc7XG5cbmNvbnN0IEdMT0JBTF9ERUZBVUxUX1NFVFRJTkdTID0ge1xuICAvLyB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDEgcmVwcmVzZW50aW5nIG1hdGNoIHN0cmVuZ3RoLCBiZWxvdyB3aGljaCBhbiBpbWFnZVxuICAvLyBlbGVtZW50IHdpbGwgbm90IGJlIGZvdW5kXG4gIGltYWdlTWF0Y2hUaHJlc2hvbGQ6IERFRkFVTFRfTUFUQ0hfVEhSRVNIT0xELFxuXG4gIC8vIGlmIHRoZSBpbWFnZSByZXR1cm5lZCBieSBnZXRTY3JlZW5zaG90IGRpZmZlcnMgaW4gc2l6ZSBvciBhc3BlY3QgcmF0aW9cbiAgLy8gZnJvbSB0aGUgc2NyZWVuLCBhdHRlbXB0IHRvIGZpeCBpdCBhdXRvbWF0aWNhbGx5XG4gIGZpeEltYWdlRmluZFNjcmVlbnNob3REaW1zOiB0cnVlLFxuXG4gIC8vIHdoZXRoZXIgQXBwaXVtIHNob3VsZCBlbnN1cmUgdGhhdCBhbiBpbWFnZSB0ZW1wbGF0ZSBzZW50IGluIGR1cmluZyBpbWFnZVxuICAvLyBlbGVtZW50IGZpbmQgc2hvdWxkIGhhdmUgaXRzIHNpemUgYWRqdXN0ZWQgc28gdGhlIG1hdGNoIGFsZ29yaXRobSB3aWxsIG5vdFxuICAvLyBjb21wbGFpblxuICBmaXhJbWFnZVRlbXBsYXRlU2l6ZTogZmFsc2UsXG5cbiAgLy8gd2hldGhlciBBcHBpdW0gc2hvdWxkIGVuc3VyZSB0aGF0IGFuIGltYWdlIHRlbXBsYXRlIHNlbnQgaW4gZHVyaW5nIGltYWdlXG4gIC8vIGVsZW1lbnQgZmluZCBzaG91bGQgaGF2ZSBpdHMgc2NhbGUgYWRqdXN0ZWQgdG8gZGlzcGxheSBzaXplIHNvIHRoZSBtYXRjaFxuICAvLyBhbGdvcml0aG0gd2lsbCBub3QgY29tcGxhaW4uXG4gIC8vIGUuZy4gaU9TIGhhcyBgd2lkdGg9Mzc1LCBoZWlnaHQ9NjY3YCB3aW5kb3cgcmVjdCwgYnV0IGl0cyBzY3JlZW5zaG90IGlzXG4gIC8vICAgICAgYHdpZHRoPTc1MCDDlyBoZWlnaHQ9MTMzNGAgcGl4ZWxzLiBUaGlzIHNldHRpbmcgaGVscCB0byBhZGp1c3QgdGhlIHNjYWxlXG4gIC8vICAgICAgaWYgYSB1c2VyIHVzZSBgd2lkdGg9NzUwIMOXIGhlaWdodD0xMzM0YCBwaXhlbHMncyBiYXNlIHRlbXBsYXRlIGltYWdlLlxuICBmaXhJbWFnZVRlbXBsYXRlU2NhbGU6IGZhbHNlLFxuXG4gIC8vIFVzZXJzIG1pZ2h0IGhhdmUgc2NhbGVkIHRlbXBsYXRlIGltYWdlIHRvIHJlZHVjZSB0aGVpciBzdG9yYWdlIHNpemUuXG4gIC8vIFRoaXMgc2V0dGluZyBhbGxvd3MgdXNlcnMgdG8gc2NhbGUgYSB0ZW1wbGF0ZSBpbWFnZSB0aGV5IHNlbmQgdG8gQXBwaXVtIHNlcnZlclxuICAvLyBzbyB0aGF0IHRoZSBBcHBpdW0gc2VydmVyIGNvbXBhcmVzIHRoZSBhY3R1YWwgc2NhbGUgdXNlcnMgb3JpZ2luYWxseSBoYWQuXG4gIC8vIGUuZy4gSWYgYSB1c2VyIGhhcyBhbiBpbWFnZSBvZiAyNzAgeCAzMiBwaXhlbHMgd2hpY2ggd2FzIG9yaWdpbmFsbHkgMTA4MCB4IDEyNiBwaXhlbHMsXG4gIC8vICAgICAgdGhlIHVzZXIgY2FuIHNldCB7ZGVmYXVsdEltYWdlVGVtcGxhdGVTY2FsZTogNC4wfSB0byBzY2FsZSB0aGUgc21hbGwgaW1hZ2VcbiAgLy8gICAgICB0byB0aGUgb3JpZ2luYWwgb25lIHNvIHRoYXQgQXBwaXVtIGNhbiBjb21wYXJlIGl0IGFzIHRoZSBvcmlnaW5hbCBvbmUuXG4gIGRlZmF1bHRJbWFnZVRlbXBsYXRlU2NhbGU6IERFRkFVTFRfVEVNUExBVEVfSU1BR0VfU0NBTEUsXG5cbiAgLy8gd2hldGhlciBBcHBpdW0gc2hvdWxkIHJlLWNoZWNrIHRoYXQgYW4gaW1hZ2UgZWxlbWVudCBjYW4gYmUgbWF0Y2hlZFxuICAvLyBhZ2FpbnN0IHRoZSBjdXJyZW50IHNjcmVlbnNob3QgYmVmb3JlIGNsaWNraW5nIGl0XG4gIGNoZWNrRm9ySW1hZ2VFbGVtZW50U3RhbGVuZXNzOiB0cnVlLFxuXG4gIC8vIHdoZXRoZXIgYmVmb3JlIGNsaWNraW5nIG9uIGFuIGltYWdlIGVsZW1lbnQgQXBwaXVtIHNob3VsZCByZS1kZXRlcm1pbmUgdGhlXG4gIC8vIHBvc2l0aW9uIG9mIHRoZSBlbGVtZW50IG9uIHNjcmVlblxuICBhdXRvVXBkYXRlSW1hZ2VFbGVtZW50UG9zaXRpb246IGZhbHNlLFxuXG4gIC8vIHdoaWNoIG1ldGhvZCB0byB1c2UgZm9yIHRhcHBpbmcgYnkgY29vcmRpbmF0ZSBmb3IgaW1hZ2UgZWxlbWVudHMuIHRoZVxuICAvLyBvcHRpb25zIGFyZSAndzNjJyBvciAnbWpzb253cCdcbiAgaW1hZ2VFbGVtZW50VGFwU3RyYXRlZ3k6IElNQUdFX0VMX1RBUF9TVFJBVEVHWV9XM0MsXG5cbiAgLy8gd2hpY2ggbWV0aG9kIHRvIHVzZSB0byBzYXZlIHRoZSBtYXRjaGVkIGltYWdlIGFyZWEgaW4gSW1hZ2VFbGVtZW50IGNsYXNzLlxuICAvLyBJdCBpcyB1c2VkIGZvciBkZWJ1Z2dpbmcgcHVycG9zZS5cbiAgZ2V0TWF0Y2hlZEltYWdlUmVzdWx0OiBmYWxzZSxcbn07XG5cbi8vIGRlY2xhcmUgc2V0dGluZ3MgdGhhdCBhcmUgcmVhbGx5IGhhbmRsZWQgb25seSBieSBiYXNlZHJpdmVyLCBzbyBkb3duc3RyZWFtXG4vLyBkcml2ZXJzIGNhbiBjaG9vc2UgdG8gaWdub3JlIHRoZW0gZm9yIHRoZWlyIG93biBzZXR0aW5ncyB2YWxpZGF0aW9uLCBldGMuLi5cbmNvbnN0IEJBU0VEUklWRVJfSEFORExFRF9TRVRUSU5HUyA9IFtcbiAgJ2ltYWdlTWF0Y2hUaHJlc2hvbGQnLFxuICAnZml4SW1hZ2VGaW5kU2NyZWVuc2hvdERpbXMnLFxuICAnZml4SW1hZ2VUZW1wbGF0ZVNpemUnLFxuICAnZml4SW1hZ2VUZW1wbGF0ZVNjYWxlJyxcbiAgJ2RlZmF1bHRJbWFnZVRlbXBsYXRlU2NhbGUnLFxuICAnY2hlY2tGb3JJbWFnZUVsZW1lbnRTdGFsZW5lc3MnLFxuICAnYXV0b1VwZGF0ZUltYWdlRWxlbWVudFBvc2l0aW9uJyxcbiAgJ2ltYWdlRWxlbWVudFRhcFN0cmF0ZWd5JyxcbiAgJ2dldE1hdGNoZWRJbWFnZVJlc3VsdCcsXG5dO1xuXG5jbGFzcyBEZXZpY2VTZXR0aW5ncyB7XG5cbiAgY29uc3RydWN0b3IgKGRlZmF1bHRTZXR0aW5ncyA9IHt9LCBvblNldHRpbmdzVXBkYXRlID0gbnVsbCkge1xuICAgIHRoaXMuX3NldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgR0xPQkFMX0RFRkFVTFRfU0VUVElOR1MsIGRlZmF1bHRTZXR0aW5ncyk7XG4gICAgdGhpcy5vblNldHRpbmdzVXBkYXRlID0gb25TZXR0aW5nc1VwZGF0ZTtcbiAgfVxuXG4gIC8vIGNhbGxzIHVwZGF0ZVNldHRpbmdzIGZyb20gaW1wbGVtZW50aW5nIGRyaXZlciBldmVyeSB0aW1lIGEgc2V0dGluZyBpcyBjaGFuZ2VkLlxuICBhc3luYyB1cGRhdGUgKG5ld1NldHRpbmdzKSB7XG4gICAgaWYgKCFfLmlzUGxhaW5PYmplY3QobmV3U2V0dGluZ3MpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFNldHRpbmdzIHVwZGF0ZSBzaG91bGQgYmUgY2FsbGVkIHdpdGggdmFsaWQgSlNPTi4gR290IGAgK1xuICAgICAgICBgJHtKU09OLnN0cmluZ2lmeShuZXdTZXR0aW5ncyl9IGluc3RlYWRgKTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBwcm9wIG9mIF8ua2V5cyhuZXdTZXR0aW5ncykpIHtcbiAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh0aGlzLl9zZXR0aW5nc1twcm9wXSkpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NldHRpbmdzW3Byb3BdID09PSBuZXdTZXR0aW5nc1twcm9wXSkge1xuICAgICAgICAgIGxvZy5kZWJ1ZyhgVGhlIHZhbHVlIG9mICcke3Byb3B9JyBzZXR0aW5nIGRpZCBub3QgY2hhbmdlLiBTa2lwcGluZyB0aGUgdXBkYXRlIGZvciBpdGApO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyB1cGRhdGUgc2V0dGluZyBvbmx5IHdoZW4gdGhlcmUgaXMgdXBkYXRlU2V0dGluZ3MgZGVmaW5lZC5cbiAgICAgIGlmIChfLmlzRnVuY3Rpb24odGhpcy5vblNldHRpbmdzVXBkYXRlKSkge1xuICAgICAgICBhd2FpdCB0aGlzLm9uU2V0dGluZ3NVcGRhdGUocHJvcCwgbmV3U2V0dGluZ3NbcHJvcF0sIHRoaXMuX3NldHRpbmdzW3Byb3BdKTtcbiAgICAgICAgdGhpcy5fc2V0dGluZ3NbcHJvcF0gPSBuZXdTZXR0aW5nc1twcm9wXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZy5lcnJvckFuZFRocm93KGBVbmFibGUgdG8gdXBkYXRlIHNldHRpbmdzOyBgICtcbiAgICAgICAgICBgb25TZXR0aW5nc1VwZGF0ZSBtZXRob2Qgbm90IGZvdW5kIG9uICcke3RoaXMuY29uc3RydWN0b3IubmFtZX0nYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZ2V0U2V0dGluZ3MgKCkge1xuICAgIHJldHVybiB0aGlzLl9zZXR0aW5ncztcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBEZXZpY2VTZXR0aW5ncztcbmV4cG9ydCB7IERldmljZVNldHRpbmdzLCBCQVNFRFJJVkVSX0hBTkRMRURfU0VUVElOR1MgfTtcbiJdLCJmaWxlIjoibGliL2Jhc2Vkcml2ZXIvZGV2aWNlLXNldHRpbmdzLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
