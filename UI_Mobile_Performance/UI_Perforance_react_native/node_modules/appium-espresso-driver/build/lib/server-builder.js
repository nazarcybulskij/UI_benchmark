"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.buildServerSigningConfig = buildServerSigningConfig;
exports.default = exports.GRADLE_DEPENDENCIES_PLACEHOLDER = exports.GRADLE_URL_TEMPLATE = exports.VERSION_KEYS = exports.ServerBuilder = void 0;

require("source-map-support/register");

var _teen_process = require("teen_process");

var _appiumSupport = require("appium-support");

var _lodash = _interopRequireDefault(require("lodash"));

var _logger = _interopRequireDefault(require("./logger"));

var _path = _interopRequireDefault(require("path"));

var _os = require("os");

const GRADLE_VERSION_KEY = 'gradle';
const GRADLE_URL_PREFIX = 'distributionUrl=';
const GRADLE_URL_TEMPLATE = 'https\\://services.gradle.org/distributions/gradle-VERSION-all.zip';
exports.GRADLE_URL_TEMPLATE = GRADLE_URL_TEMPLATE;
const GRADLE_MAX_ERROR_LOG_LINES = 15;
const GRADLE_DEPENDENCIES_PLACEHOLDER = '// additionalAppDependencies placeholder (don\'t change or delete this line)';
exports.GRADLE_DEPENDENCIES_PLACEHOLDER = GRADLE_DEPENDENCIES_PLACEHOLDER;
const VERSION_KEYS = [GRADLE_VERSION_KEY, 'androidGradlePlugin', 'compileSdk', 'buildTools', 'minSdk', 'targetSdk', 'kotlin'];
exports.VERSION_KEYS = VERSION_KEYS;

const gradleLog = _appiumSupport.logger.getLogger('Gradle');

function buildServerSigningConfig(args) {
  return {
    zipAlign: true,
    keystoreFile: args.keystoreFile,
    keystorePassword: args.keystorePassword,
    keyAlias: args.keyAlias,
    keyPassword: args.keyPassword
  };
}

class ServerBuilder {
  constructor(args = {}) {
    this.serverPath = args.serverPath;
    this.showGradleLog = args.showGradleLog;
    const buildConfiguration = args.buildConfiguration || {};
    const versionConfiguration = buildConfiguration.toolsVersions || {};
    this.serverVersions = _lodash.default.reduce(versionConfiguration, (acc, value, key) => {
      if (VERSION_KEYS.includes(key)) {
        acc[key] = value;
      } else {
        _logger.default.warn(`Got unexpected '${key}' in toolsVersion block of the build configuration`);
      }

      return acc;
    }, {});
    this.testAppPackage = args.testAppPackage;
    this.signingConfig = args.signingConfig;
    this.additionalAppDependencies = buildConfiguration.additionalAppDependencies || [];
  }

  async build() {
    if (this.serverVersions[GRADLE_VERSION_KEY]) {
      await this.setGradleWrapperVersion(this.serverVersions[GRADLE_VERSION_KEY]);
    }

    if (!Array.isArray(this.additionalAppDependencies)) {
      throw new Error('additionalAppDependencies must be an array');
    }

    if (!_lodash.default.isEmpty(this.additionalAppDependencies)) {
      await this.insertAdditionalAppDependencies(this.additionalAppDependencies);
    }

    await this.runBuildProcess();
  }

  getCommand() {
    const cmd = _appiumSupport.system.isWindows() ? 'gradlew.bat' : './gradlew';

    const buildProperty = (key, value) => value ? `-P${key}=${value}` : null;

    let args = VERSION_KEYS.filter(key => key !== GRADLE_VERSION_KEY).map(key => {
      const serverVersion = this.serverVersions[key];
      const gradleProperty = `appium${key.charAt(0).toUpperCase()}${key.slice(1)}`;
      return buildProperty(gradleProperty, serverVersion);
    }).filter(Boolean);

    if (this.signingConfig) {
      args.push(..._lodash.default.keys(this.signingConfig).map(key => [`appium${_lodash.default.upperFirst(key)}`, this.signingConfig[key]]).map(([k, v]) => buildProperty(k, v)).filter(Boolean));
    }

    if (this.testAppPackage) {
      args.push(buildProperty('appiumTargetPackage', this.testAppPackage));
    }

    args.push('assembleAndroidTest');
    return {
      cmd,
      args
    };
  }

  async setGradleWrapperVersion(version) {
    const propertiesPath = _path.default.resolve(this.serverPath, 'gradle', 'wrapper', 'gradle-wrapper.properties');

    const originalProperties = await _appiumSupport.fs.readFile(propertiesPath, 'utf8');
    const newProperties = this.updateGradleDistUrl(originalProperties, version);
    await _appiumSupport.fs.writeFile(propertiesPath, newProperties, 'utf8');
  }

  updateGradleDistUrl(propertiesContent, version) {
    return propertiesContent.replace(new RegExp(`^(${_lodash.default.escapeRegExp(GRADLE_URL_PREFIX)}).+$`, 'gm'), `$1${GRADLE_URL_TEMPLATE.replace('VERSION', version)}`);
  }

  async insertAdditionalAppDependencies(additionalAppDependencies) {
    const buildPath = _path.default.resolve(this.serverPath, 'app', 'build.gradle');

    const originalConfiguration = await _appiumSupport.fs.readFile(buildPath, 'utf8');
    const newConfiguration = this.updateDependencyLines(originalConfiguration, additionalAppDependencies);
    await _appiumSupport.fs.writeFile(buildPath, newConfiguration, 'utf8');
  }

  updateDependencyLines(configurationContent, additionalAppDependencies) {
    const dependencyLines = additionalAppDependencies.map(function (dependency) {
      if (/[\s'\\$]/.test(dependency)) {
        throw new Error('Single quotes, dollar characters and whitespace characters' + ` are disallowed in additional dependencies: ${dependency}`);
      }

      return `implementation '${dependency}'`;
    }).join('$1');
    return configurationContent.replace(new RegExp(`(\\s*^\\s*)${_lodash.default.escapeRegExp(GRADLE_DEPENDENCIES_PLACEHOLDER)}\\s*$`, 'gm'), `$1${dependencyLines}`);
  }

  async runBuildProcess() {
    const {
      cmd,
      args
    } = this.getCommand();

    _logger.default.debug(`Beginning build with command '${cmd} ${args.join(' ')}' ` + `in directory '${this.serverPath}'`);

    const gradlebuild = new _teen_process.SubProcess(cmd, args, {
      cwd: this.serverPath,
      stdio: ['ignore', 'pipe', 'pipe']
    });
    let buildLastLines = [];
    const logMsg = `Output from Gradle ${this.showGradleLog ? 'will' : 'will not'} be logged`;

    _logger.default.debug(`${logMsg}. To change this, use 'showGradleLog' desired capability`);

    gradlebuild.on('stream-line', line => {
      if (this.showGradleLog) {
        if (line.startsWith('[STDERR]')) {
          gradleLog.warn(line);
        } else {
          gradleLog.info(line);
        }
      }

      buildLastLines.push(`${_os.EOL}${line}`);

      if (buildLastLines.length > GRADLE_MAX_ERROR_LOG_LINES) {
        buildLastLines = buildLastLines.slice(-GRADLE_MAX_ERROR_LOG_LINES);
      }
    });

    try {
      await gradlebuild.start();
      await gradlebuild.join();
    } catch (err) {
      let msg = `Unable to build Espresso server - ${err.message}\n` + `Gradle error message:${_os.EOL}${buildLastLines}`;

      _logger.default.errorAndThrow(msg);
    }
  }

}

exports.ServerBuilder = ServerBuilder;
var _default = ServerBuilder;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9zZXJ2ZXItYnVpbGRlci5qcyJdLCJuYW1lcyI6WyJHUkFETEVfVkVSU0lPTl9LRVkiLCJHUkFETEVfVVJMX1BSRUZJWCIsIkdSQURMRV9VUkxfVEVNUExBVEUiLCJHUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUyIsIkdSQURMRV9ERVBFTkRFTkNJRVNfUExBQ0VIT0xERVIiLCJWRVJTSU9OX0tFWVMiLCJncmFkbGVMb2ciLCJsb2dnZXIiLCJnZXRMb2dnZXIiLCJidWlsZFNlcnZlclNpZ25pbmdDb25maWciLCJhcmdzIiwiemlwQWxpZ24iLCJrZXlzdG9yZUZpbGUiLCJrZXlzdG9yZVBhc3N3b3JkIiwia2V5QWxpYXMiLCJrZXlQYXNzd29yZCIsIlNlcnZlckJ1aWxkZXIiLCJjb25zdHJ1Y3RvciIsInNlcnZlclBhdGgiLCJzaG93R3JhZGxlTG9nIiwiYnVpbGRDb25maWd1cmF0aW9uIiwidmVyc2lvbkNvbmZpZ3VyYXRpb24iLCJ0b29sc1ZlcnNpb25zIiwic2VydmVyVmVyc2lvbnMiLCJfIiwicmVkdWNlIiwiYWNjIiwidmFsdWUiLCJrZXkiLCJpbmNsdWRlcyIsImxvZyIsIndhcm4iLCJ0ZXN0QXBwUGFja2FnZSIsInNpZ25pbmdDb25maWciLCJhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzIiwiYnVpbGQiLCJzZXRHcmFkbGVXcmFwcGVyVmVyc2lvbiIsIkFycmF5IiwiaXNBcnJheSIsIkVycm9yIiwiaXNFbXB0eSIsImluc2VydEFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMiLCJydW5CdWlsZFByb2Nlc3MiLCJnZXRDb21tYW5kIiwiY21kIiwic3lzdGVtIiwiaXNXaW5kb3dzIiwiYnVpbGRQcm9wZXJ0eSIsImZpbHRlciIsIm1hcCIsInNlcnZlclZlcnNpb24iLCJncmFkbGVQcm9wZXJ0eSIsImNoYXJBdCIsInRvVXBwZXJDYXNlIiwic2xpY2UiLCJCb29sZWFuIiwicHVzaCIsImtleXMiLCJ1cHBlckZpcnN0IiwiayIsInYiLCJ2ZXJzaW9uIiwicHJvcGVydGllc1BhdGgiLCJwYXRoIiwicmVzb2x2ZSIsIm9yaWdpbmFsUHJvcGVydGllcyIsImZzIiwicmVhZEZpbGUiLCJuZXdQcm9wZXJ0aWVzIiwidXBkYXRlR3JhZGxlRGlzdFVybCIsIndyaXRlRmlsZSIsInByb3BlcnRpZXNDb250ZW50IiwicmVwbGFjZSIsIlJlZ0V4cCIsImVzY2FwZVJlZ0V4cCIsImJ1aWxkUGF0aCIsIm9yaWdpbmFsQ29uZmlndXJhdGlvbiIsIm5ld0NvbmZpZ3VyYXRpb24iLCJ1cGRhdGVEZXBlbmRlbmN5TGluZXMiLCJjb25maWd1cmF0aW9uQ29udGVudCIsImRlcGVuZGVuY3lMaW5lcyIsImRlcGVuZGVuY3kiLCJ0ZXN0Iiwiam9pbiIsImRlYnVnIiwiZ3JhZGxlYnVpbGQiLCJTdWJQcm9jZXNzIiwiY3dkIiwic3RkaW8iLCJidWlsZExhc3RMaW5lcyIsImxvZ01zZyIsIm9uIiwibGluZSIsInN0YXJ0c1dpdGgiLCJpbmZvIiwiRU9MIiwibGVuZ3RoIiwic3RhcnQiLCJlcnIiLCJtc2ciLCJtZXNzYWdlIiwiZXJyb3JBbmRUaHJvdyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBRUEsTUFBTUEsa0JBQWtCLEdBQUcsUUFBM0I7QUFDQSxNQUFNQyxpQkFBaUIsR0FBRyxrQkFBMUI7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRyxvRUFBNUI7O0FBQ0EsTUFBTUMsMEJBQTBCLEdBQUcsRUFBbkM7QUFFQSxNQUFNQywrQkFBK0IsR0FBRyw4RUFBeEM7O0FBRUEsTUFBTUMsWUFBWSxHQUFHLENBQ25CTCxrQkFEbUIsRUFFbkIscUJBRm1CLEVBR25CLFlBSG1CLEVBSW5CLFlBSm1CLEVBS25CLFFBTG1CLEVBTW5CLFdBTm1CLEVBT25CLFFBUG1CLENBQXJCOzs7QUFVQSxNQUFNTSxTQUFTLEdBQUdDLHNCQUFPQyxTQUFQLENBQWlCLFFBQWpCLENBQWxCOztBQUVBLFNBQVNDLHdCQUFULENBQW1DQyxJQUFuQyxFQUF5QztBQUN2QyxTQUFPO0FBQ0xDLElBQUFBLFFBQVEsRUFBRSxJQURMO0FBRUxDLElBQUFBLFlBQVksRUFBRUYsSUFBSSxDQUFDRSxZQUZkO0FBR0xDLElBQUFBLGdCQUFnQixFQUFFSCxJQUFJLENBQUNHLGdCQUhsQjtBQUlMQyxJQUFBQSxRQUFRLEVBQUVKLElBQUksQ0FBQ0ksUUFKVjtBQUtMQyxJQUFBQSxXQUFXLEVBQUVMLElBQUksQ0FBQ0s7QUFMYixHQUFQO0FBT0Q7O0FBRUQsTUFBTUMsYUFBTixDQUFvQjtBQUNsQkMsRUFBQUEsV0FBVyxDQUFFUCxJQUFJLEdBQUcsRUFBVCxFQUFhO0FBQ3RCLFNBQUtRLFVBQUwsR0FBa0JSLElBQUksQ0FBQ1EsVUFBdkI7QUFDQSxTQUFLQyxhQUFMLEdBQXFCVCxJQUFJLENBQUNTLGFBQTFCO0FBRUEsVUFBTUMsa0JBQWtCLEdBQUdWLElBQUksQ0FBQ1Usa0JBQUwsSUFBMkIsRUFBdEQ7QUFFQSxVQUFNQyxvQkFBb0IsR0FBR0Qsa0JBQWtCLENBQUNFLGFBQW5CLElBQW9DLEVBQWpFO0FBQ0EsU0FBS0MsY0FBTCxHQUFzQkMsZ0JBQUVDLE1BQUYsQ0FBU0osb0JBQVQsRUFBK0IsQ0FBQ0ssR0FBRCxFQUFNQyxLQUFOLEVBQWFDLEdBQWIsS0FBcUI7QUFDeEUsVUFBSXZCLFlBQVksQ0FBQ3dCLFFBQWIsQ0FBc0JELEdBQXRCLENBQUosRUFBZ0M7QUFDOUJGLFFBQUFBLEdBQUcsQ0FBQ0UsR0FBRCxDQUFILEdBQVdELEtBQVg7QUFDRCxPQUZELE1BRU87QUFDTEcsd0JBQUlDLElBQUosQ0FBVSxtQkFBa0JILEdBQUksb0RBQWhDO0FBQ0Q7O0FBQ0QsYUFBT0YsR0FBUDtBQUNELEtBUHFCLEVBT25CLEVBUG1CLENBQXRCO0FBU0EsU0FBS00sY0FBTCxHQUFzQnRCLElBQUksQ0FBQ3NCLGNBQTNCO0FBQ0EsU0FBS0MsYUFBTCxHQUFxQnZCLElBQUksQ0FBQ3VCLGFBQTFCO0FBRUEsU0FBS0MseUJBQUwsR0FBaUNkLGtCQUFrQixDQUFDYyx5QkFBbkIsSUFBZ0QsRUFBakY7QUFDRDs7QUFFRCxRQUFNQyxLQUFOLEdBQWU7QUFDYixRQUFJLEtBQUtaLGNBQUwsQ0FBb0J2QixrQkFBcEIsQ0FBSixFQUE2QztBQUMzQyxZQUFNLEtBQUtvQyx1QkFBTCxDQUE2QixLQUFLYixjQUFMLENBQW9CdkIsa0JBQXBCLENBQTdCLENBQU47QUFDRDs7QUFFRCxRQUFJLENBQUNxQyxLQUFLLENBQUNDLE9BQU4sQ0FBYyxLQUFLSix5QkFBbkIsQ0FBTCxFQUFvRDtBQUNsRCxZQUFNLElBQUlLLEtBQUosQ0FBVSw0Q0FBVixDQUFOO0FBQ0Q7O0FBQ0QsUUFBSSxDQUFDZixnQkFBRWdCLE9BQUYsQ0FBVSxLQUFLTix5QkFBZixDQUFMLEVBQWdEO0FBQzlDLFlBQU0sS0FBS08sK0JBQUwsQ0FBcUMsS0FBS1AseUJBQTFDLENBQU47QUFDRDs7QUFFRCxVQUFNLEtBQUtRLGVBQUwsRUFBTjtBQUNEOztBQUVEQyxFQUFBQSxVQUFVLEdBQUk7QUFDWixVQUFNQyxHQUFHLEdBQUdDLHNCQUFPQyxTQUFQLEtBQXFCLGFBQXJCLEdBQXFDLFdBQWpEOztBQUNBLFVBQU1DLGFBQWEsR0FBRyxDQUFDbkIsR0FBRCxFQUFNRCxLQUFOLEtBQWdCQSxLQUFLLEdBQUksS0FBSUMsR0FBSSxJQUFHRCxLQUFNLEVBQXJCLEdBQXlCLElBQXBFOztBQUNBLFFBQUlqQixJQUFJLEdBQUdMLFlBQVksQ0FDcEIyQyxNQURRLENBQ0FwQixHQUFELElBQVNBLEdBQUcsS0FBSzVCLGtCQURoQixFQUVSaUQsR0FGUSxDQUVIckIsR0FBRCxJQUFTO0FBQ1osWUFBTXNCLGFBQWEsR0FBRyxLQUFLM0IsY0FBTCxDQUFvQkssR0FBcEIsQ0FBdEI7QUFDQSxZQUFNdUIsY0FBYyxHQUFJLFNBQVF2QixHQUFHLENBQUN3QixNQUFKLENBQVcsQ0FBWCxFQUFjQyxXQUFkLEVBQTRCLEdBQUV6QixHQUFHLENBQUMwQixLQUFKLENBQVUsQ0FBVixDQUFhLEVBQTNFO0FBQ0EsYUFBT1AsYUFBYSxDQUFDSSxjQUFELEVBQWlCRCxhQUFqQixDQUFwQjtBQUNELEtBTlEsRUFPUkYsTUFQUSxDQU9ETyxPQVBDLENBQVg7O0FBU0EsUUFBSSxLQUFLdEIsYUFBVCxFQUF3QjtBQUN0QnZCLE1BQUFBLElBQUksQ0FBQzhDLElBQUwsQ0FBVSxHQUNSaEMsZ0JBQUVpQyxJQUFGLENBQU8sS0FBS3hCLGFBQVosRUFDQ2dCLEdBREQsQ0FDTXJCLEdBQUQsSUFBUyxDQUFFLFNBQVFKLGdCQUFFa0MsVUFBRixDQUFhOUIsR0FBYixDQUFrQixFQUE1QixFQUErQixLQUFLSyxhQUFMLENBQW1CTCxHQUFuQixDQUEvQixDQURkLEVBRUNxQixHQUZELENBRUssQ0FBQyxDQUFDVSxDQUFELEVBQUlDLENBQUosQ0FBRCxLQUFZYixhQUFhLENBQUNZLENBQUQsRUFBSUMsQ0FBSixDQUY5QixFQUdDWixNQUhELENBR1FPLE9BSFIsQ0FERjtBQU1EOztBQUVELFFBQUksS0FBS3ZCLGNBQVQsRUFBeUI7QUFDdkJ0QixNQUFBQSxJQUFJLENBQUM4QyxJQUFMLENBQVVULGFBQWEsQ0FBQyxxQkFBRCxFQUF3QixLQUFLZixjQUE3QixDQUF2QjtBQUNEOztBQUNEdEIsSUFBQUEsSUFBSSxDQUFDOEMsSUFBTCxDQUFVLHFCQUFWO0FBRUEsV0FBTztBQUFDWixNQUFBQSxHQUFEO0FBQU1sQyxNQUFBQTtBQUFOLEtBQVA7QUFDRDs7QUFFRCxRQUFNMEIsdUJBQU4sQ0FBK0J5QixPQUEvQixFQUF3QztBQUN0QyxVQUFNQyxjQUFjLEdBQUdDLGNBQUtDLE9BQUwsQ0FBYSxLQUFLOUMsVUFBbEIsRUFBOEIsUUFBOUIsRUFBd0MsU0FBeEMsRUFBbUQsMkJBQW5ELENBQXZCOztBQUNBLFVBQU0rQyxrQkFBa0IsR0FBRyxNQUFNQyxrQkFBR0MsUUFBSCxDQUFZTCxjQUFaLEVBQTRCLE1BQTVCLENBQWpDO0FBQ0EsVUFBTU0sYUFBYSxHQUFHLEtBQUtDLG1CQUFMLENBQXlCSixrQkFBekIsRUFBNkNKLE9BQTdDLENBQXRCO0FBQ0EsVUFBTUssa0JBQUdJLFNBQUgsQ0FBYVIsY0FBYixFQUE2Qk0sYUFBN0IsRUFBNEMsTUFBNUMsQ0FBTjtBQUNEOztBQUVEQyxFQUFBQSxtQkFBbUIsQ0FBRUUsaUJBQUYsRUFBcUJWLE9BQXJCLEVBQThCO0FBQy9DLFdBQU9VLGlCQUFpQixDQUFDQyxPQUFsQixDQUNMLElBQUlDLE1BQUosQ0FBWSxLQUFJakQsZ0JBQUVrRCxZQUFGLENBQWV6RSxpQkFBZixDQUFrQyxNQUFsRCxFQUF5RCxJQUF6RCxDQURLLEVBRUosS0FBSUMsbUJBQW1CLENBQUNzRSxPQUFwQixDQUE0QixTQUE1QixFQUF1Q1gsT0FBdkMsQ0FBZ0QsRUFGaEQsQ0FBUDtBQUlEOztBQUVELFFBQU1wQiwrQkFBTixDQUF1Q1AseUJBQXZDLEVBQWtFO0FBQ2hFLFVBQU15QyxTQUFTLEdBQUdaLGNBQUtDLE9BQUwsQ0FBYSxLQUFLOUMsVUFBbEIsRUFBOEIsS0FBOUIsRUFBcUMsY0FBckMsQ0FBbEI7O0FBQ0EsVUFBTTBELHFCQUFxQixHQUFHLE1BQU1WLGtCQUFHQyxRQUFILENBQVlRLFNBQVosRUFBdUIsTUFBdkIsQ0FBcEM7QUFDQSxVQUFNRSxnQkFBZ0IsR0FBRyxLQUFLQyxxQkFBTCxDQUEyQkYscUJBQTNCLEVBQWtEMUMseUJBQWxELENBQXpCO0FBQ0EsVUFBTWdDLGtCQUFHSSxTQUFILENBQWFLLFNBQWIsRUFBd0JFLGdCQUF4QixFQUEwQyxNQUExQyxDQUFOO0FBQ0Q7O0FBRURDLEVBQUFBLHFCQUFxQixDQUFFQyxvQkFBRixFQUF3QjdDLHlCQUF4QixFQUFtRDtBQUN0RSxVQUFNOEMsZUFBZSxHQUFHOUMseUJBQXlCLENBQzlDZSxHQURxQixDQUNqQixVQUFVZ0MsVUFBVixFQUFzQjtBQUd6QixVQUFJLFdBQVdDLElBQVgsQ0FBZ0JELFVBQWhCLENBQUosRUFBaUM7QUFDL0IsY0FBTSxJQUFJMUMsS0FBSixDQUFVLCtEQUNiLCtDQUE4QzBDLFVBQVcsRUFEdEQsQ0FBTjtBQUVEOztBQUNELGFBQVEsbUJBQWtCQSxVQUFXLEdBQXJDO0FBQ0QsS0FUcUIsRUFVckJFLElBVnFCLENBVWhCLElBVmdCLENBQXhCO0FBWUEsV0FBT0osb0JBQW9CLENBQUNQLE9BQXJCLENBR0wsSUFBSUMsTUFBSixDQUFZLGNBQWFqRCxnQkFBRWtELFlBQUYsQ0FBZXRFLCtCQUFmLENBQWdELE9BQXpFLEVBQWlGLElBQWpGLENBSEssRUFJSixLQUFJNEUsZUFBZ0IsRUFKaEIsQ0FBUDtBQU1EOztBQUVELFFBQU10QyxlQUFOLEdBQXlCO0FBQ3ZCLFVBQU07QUFBQ0UsTUFBQUEsR0FBRDtBQUFNbEMsTUFBQUE7QUFBTixRQUFjLEtBQUtpQyxVQUFMLEVBQXBCOztBQUNBYixvQkFBSXNELEtBQUosQ0FBVyxpQ0FBZ0N4QyxHQUFJLElBQUdsQyxJQUFJLENBQUN5RSxJQUFMLENBQVUsR0FBVixDQUFlLElBQXZELEdBQ1AsaUJBQWdCLEtBQUtqRSxVQUFXLEdBRG5DOztBQUVBLFVBQU1tRSxXQUFXLEdBQUcsSUFBSUMsd0JBQUosQ0FBZTFDLEdBQWYsRUFBb0JsQyxJQUFwQixFQUEwQjtBQUM1QzZFLE1BQUFBLEdBQUcsRUFBRSxLQUFLckUsVUFEa0M7QUFFNUNzRSxNQUFBQSxLQUFLLEVBQUUsQ0FBQyxRQUFELEVBQVcsTUFBWCxFQUFtQixNQUFuQjtBQUZxQyxLQUExQixDQUFwQjtBQUlBLFFBQUlDLGNBQWMsR0FBRyxFQUFyQjtBQUVBLFVBQU1DLE1BQU0sR0FBSSxzQkFBcUIsS0FBS3ZFLGFBQUwsR0FBcUIsTUFBckIsR0FBOEIsVUFBVyxZQUE5RTs7QUFDQVcsb0JBQUlzRCxLQUFKLENBQVcsR0FBRU0sTUFBTywwREFBcEI7O0FBQ0FMLElBQUFBLFdBQVcsQ0FBQ00sRUFBWixDQUFlLGFBQWYsRUFBK0JDLElBQUQsSUFBVTtBQUN0QyxVQUFJLEtBQUt6RSxhQUFULEVBQXdCO0FBQ3RCLFlBQUl5RSxJQUFJLENBQUNDLFVBQUwsQ0FBZ0IsVUFBaEIsQ0FBSixFQUFpQztBQUMvQnZGLFVBQUFBLFNBQVMsQ0FBQ3lCLElBQVYsQ0FBZTZELElBQWY7QUFDRCxTQUZELE1BRU87QUFDTHRGLFVBQUFBLFNBQVMsQ0FBQ3dGLElBQVYsQ0FBZUYsSUFBZjtBQUNEO0FBQ0Y7O0FBQ0RILE1BQUFBLGNBQWMsQ0FBQ2pDLElBQWYsQ0FBcUIsR0FBRXVDLE9BQUksR0FBRUgsSUFBSyxFQUFsQzs7QUFDQSxVQUFJSCxjQUFjLENBQUNPLE1BQWYsR0FBd0I3RiwwQkFBNUIsRUFBd0Q7QUFDdERzRixRQUFBQSxjQUFjLEdBQUdBLGNBQWMsQ0FBQ25DLEtBQWYsQ0FBcUIsQ0FBQ25ELDBCQUF0QixDQUFqQjtBQUNEO0FBQ0YsS0FaRDs7QUFjQSxRQUFJO0FBQ0YsWUFBTWtGLFdBQVcsQ0FBQ1ksS0FBWixFQUFOO0FBQ0EsWUFBTVosV0FBVyxDQUFDRixJQUFaLEVBQU47QUFDRCxLQUhELENBR0UsT0FBT2UsR0FBUCxFQUFZO0FBQ1osVUFBSUMsR0FBRyxHQUFJLHFDQUFvQ0QsR0FBRyxDQUFDRSxPQUFRLElBQWpELEdBQ1Asd0JBQXVCTCxPQUFJLEdBQUVOLGNBQWUsRUFEL0M7O0FBRUEzRCxzQkFBSXVFLGFBQUosQ0FBa0JGLEdBQWxCO0FBQ0Q7QUFDRjs7QUEvSWlCOzs7ZUFtSkxuRixhIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViUHJvY2VzcyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgeyBmcywgbG9nZ2VyLCBzeXN0ZW0gfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IGxvZyBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IEVPTCB9IGZyb20gJ29zJztcblxuY29uc3QgR1JBRExFX1ZFUlNJT05fS0VZID0gJ2dyYWRsZSc7XG5jb25zdCBHUkFETEVfVVJMX1BSRUZJWCA9ICdkaXN0cmlidXRpb25Vcmw9JztcbmNvbnN0IEdSQURMRV9VUkxfVEVNUExBVEUgPSAnaHR0cHNcXFxcOi8vc2VydmljZXMuZ3JhZGxlLm9yZy9kaXN0cmlidXRpb25zL2dyYWRsZS1WRVJTSU9OLWFsbC56aXAnO1xuY29uc3QgR1JBRExFX01BWF9FUlJPUl9MT0dfTElORVMgPSAxNTtcblxuY29uc3QgR1JBRExFX0RFUEVOREVOQ0lFU19QTEFDRUhPTERFUiA9ICcvLyBhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzIHBsYWNlaG9sZGVyIChkb25cXCd0IGNoYW5nZSBvciBkZWxldGUgdGhpcyBsaW5lKSc7XG5cbmNvbnN0IFZFUlNJT05fS0VZUyA9IFtcbiAgR1JBRExFX1ZFUlNJT05fS0VZLFxuICAnYW5kcm9pZEdyYWRsZVBsdWdpbicsXG4gICdjb21waWxlU2RrJyxcbiAgJ2J1aWxkVG9vbHMnLFxuICAnbWluU2RrJyxcbiAgJ3RhcmdldFNkaycsXG4gICdrb3RsaW4nXG5dO1xuXG5jb25zdCBncmFkbGVMb2cgPSBsb2dnZXIuZ2V0TG9nZ2VyKCdHcmFkbGUnKTtcblxuZnVuY3Rpb24gYnVpbGRTZXJ2ZXJTaWduaW5nQ29uZmlnIChhcmdzKSB7XG4gIHJldHVybiB7XG4gICAgemlwQWxpZ246IHRydWUsXG4gICAga2V5c3RvcmVGaWxlOiBhcmdzLmtleXN0b3JlRmlsZSxcbiAgICBrZXlzdG9yZVBhc3N3b3JkOiBhcmdzLmtleXN0b3JlUGFzc3dvcmQsXG4gICAga2V5QWxpYXM6IGFyZ3Mua2V5QWxpYXMsXG4gICAga2V5UGFzc3dvcmQ6IGFyZ3Mua2V5UGFzc3dvcmRcbiAgfTtcbn1cblxuY2xhc3MgU2VydmVyQnVpbGRlciB7XG4gIGNvbnN0cnVjdG9yIChhcmdzID0ge30pIHtcbiAgICB0aGlzLnNlcnZlclBhdGggPSBhcmdzLnNlcnZlclBhdGg7XG4gICAgdGhpcy5zaG93R3JhZGxlTG9nID0gYXJncy5zaG93R3JhZGxlTG9nO1xuXG4gICAgY29uc3QgYnVpbGRDb25maWd1cmF0aW9uID0gYXJncy5idWlsZENvbmZpZ3VyYXRpb24gfHwge307XG5cbiAgICBjb25zdCB2ZXJzaW9uQ29uZmlndXJhdGlvbiA9IGJ1aWxkQ29uZmlndXJhdGlvbi50b29sc1ZlcnNpb25zIHx8IHt9O1xuICAgIHRoaXMuc2VydmVyVmVyc2lvbnMgPSBfLnJlZHVjZSh2ZXJzaW9uQ29uZmlndXJhdGlvbiwgKGFjYywgdmFsdWUsIGtleSkgPT4ge1xuICAgICAgaWYgKFZFUlNJT05fS0VZUy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgIGFjY1trZXldID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2cud2FybihgR290IHVuZXhwZWN0ZWQgJyR7a2V5fScgaW4gdG9vbHNWZXJzaW9uIGJsb2NrIG9mIHRoZSBidWlsZCBjb25maWd1cmF0aW9uYCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcblxuICAgIHRoaXMudGVzdEFwcFBhY2thZ2UgPSBhcmdzLnRlc3RBcHBQYWNrYWdlO1xuICAgIHRoaXMuc2lnbmluZ0NvbmZpZyA9IGFyZ3Muc2lnbmluZ0NvbmZpZztcblxuICAgIHRoaXMuYWRkaXRpb25hbEFwcERlcGVuZGVuY2llcyA9IGJ1aWxkQ29uZmlndXJhdGlvbi5hZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzIHx8IFtdO1xuICB9XG5cbiAgYXN5bmMgYnVpbGQgKCkge1xuICAgIGlmICh0aGlzLnNlcnZlclZlcnNpb25zW0dSQURMRV9WRVJTSU9OX0tFWV0pIHtcbiAgICAgIGF3YWl0IHRoaXMuc2V0R3JhZGxlV3JhcHBlclZlcnNpb24odGhpcy5zZXJ2ZXJWZXJzaW9uc1tHUkFETEVfVkVSU0lPTl9LRVldKTtcbiAgICB9XG5cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkodGhpcy5hZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgICB9XG4gICAgaWYgKCFfLmlzRW1wdHkodGhpcy5hZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzKSkge1xuICAgICAgYXdhaXQgdGhpcy5pbnNlcnRBZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzKHRoaXMuYWRkaXRpb25hbEFwcERlcGVuZGVuY2llcyk7XG4gICAgfVxuXG4gICAgYXdhaXQgdGhpcy5ydW5CdWlsZFByb2Nlc3MoKTtcbiAgfVxuXG4gIGdldENvbW1hbmQgKCkge1xuICAgIGNvbnN0IGNtZCA9IHN5c3RlbS5pc1dpbmRvd3MoKSA/ICdncmFkbGV3LmJhdCcgOiAnLi9ncmFkbGV3JztcbiAgICBjb25zdCBidWlsZFByb3BlcnR5ID0gKGtleSwgdmFsdWUpID0+IHZhbHVlID8gYC1QJHtrZXl9PSR7dmFsdWV9YCA6IG51bGw7XG4gICAgbGV0IGFyZ3MgPSBWRVJTSU9OX0tFWVNcbiAgICAgIC5maWx0ZXIoKGtleSkgPT4ga2V5ICE9PSBHUkFETEVfVkVSU0lPTl9LRVkpXG4gICAgICAubWFwKChrZXkpID0+IHtcbiAgICAgICAgY29uc3Qgc2VydmVyVmVyc2lvbiA9IHRoaXMuc2VydmVyVmVyc2lvbnNba2V5XTtcbiAgICAgICAgY29uc3QgZ3JhZGxlUHJvcGVydHkgPSBgYXBwaXVtJHtrZXkuY2hhckF0KDApLnRvVXBwZXJDYXNlKCl9JHtrZXkuc2xpY2UoMSl9YDtcbiAgICAgICAgcmV0dXJuIGJ1aWxkUHJvcGVydHkoZ3JhZGxlUHJvcGVydHksIHNlcnZlclZlcnNpb24pO1xuICAgICAgfSlcbiAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICBpZiAodGhpcy5zaWduaW5nQ29uZmlnKSB7XG4gICAgICBhcmdzLnB1c2goLi4uKFxuICAgICAgICBfLmtleXModGhpcy5zaWduaW5nQ29uZmlnKVxuICAgICAgICAubWFwKChrZXkpID0+IFtgYXBwaXVtJHtfLnVwcGVyRmlyc3Qoa2V5KX1gLCB0aGlzLnNpZ25pbmdDb25maWdba2V5XV0pXG4gICAgICAgIC5tYXAoKFtrLCB2XSkgPT4gYnVpbGRQcm9wZXJ0eShrLCB2KSlcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgKSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudGVzdEFwcFBhY2thZ2UpIHtcbiAgICAgIGFyZ3MucHVzaChidWlsZFByb3BlcnR5KCdhcHBpdW1UYXJnZXRQYWNrYWdlJywgdGhpcy50ZXN0QXBwUGFja2FnZSkpO1xuICAgIH1cbiAgICBhcmdzLnB1c2goJ2Fzc2VtYmxlQW5kcm9pZFRlc3QnKTtcblxuICAgIHJldHVybiB7Y21kLCBhcmdzfTtcbiAgfVxuXG4gIGFzeW5jIHNldEdyYWRsZVdyYXBwZXJWZXJzaW9uICh2ZXJzaW9uKSB7XG4gICAgY29uc3QgcHJvcGVydGllc1BhdGggPSBwYXRoLnJlc29sdmUodGhpcy5zZXJ2ZXJQYXRoLCAnZ3JhZGxlJywgJ3dyYXBwZXInLCAnZ3JhZGxlLXdyYXBwZXIucHJvcGVydGllcycpO1xuICAgIGNvbnN0IG9yaWdpbmFsUHJvcGVydGllcyA9IGF3YWl0IGZzLnJlYWRGaWxlKHByb3BlcnRpZXNQYXRoLCAndXRmOCcpO1xuICAgIGNvbnN0IG5ld1Byb3BlcnRpZXMgPSB0aGlzLnVwZGF0ZUdyYWRsZURpc3RVcmwob3JpZ2luYWxQcm9wZXJ0aWVzLCB2ZXJzaW9uKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUocHJvcGVydGllc1BhdGgsIG5ld1Byb3BlcnRpZXMsICd1dGY4Jyk7XG4gIH1cblxuICB1cGRhdGVHcmFkbGVEaXN0VXJsIChwcm9wZXJ0aWVzQ29udGVudCwgdmVyc2lvbikge1xuICAgIHJldHVybiBwcm9wZXJ0aWVzQ29udGVudC5yZXBsYWNlKFxuICAgICAgbmV3IFJlZ0V4cChgXigke18uZXNjYXBlUmVnRXhwKEdSQURMRV9VUkxfUFJFRklYKX0pLiskYCwgJ2dtJyksXG4gICAgICBgJDEke0dSQURMRV9VUkxfVEVNUExBVEUucmVwbGFjZSgnVkVSU0lPTicsIHZlcnNpb24pfWBcbiAgICApO1xuICB9XG5cbiAgYXN5bmMgaW5zZXJ0QWRkaXRpb25hbEFwcERlcGVuZGVuY2llcyAoYWRkaXRpb25hbEFwcERlcGVuZGVuY2llcykge1xuICAgIGNvbnN0IGJ1aWxkUGF0aCA9IHBhdGgucmVzb2x2ZSh0aGlzLnNlcnZlclBhdGgsICdhcHAnLCAnYnVpbGQuZ3JhZGxlJyk7XG4gICAgY29uc3Qgb3JpZ2luYWxDb25maWd1cmF0aW9uID0gYXdhaXQgZnMucmVhZEZpbGUoYnVpbGRQYXRoLCAndXRmOCcpO1xuICAgIGNvbnN0IG5ld0NvbmZpZ3VyYXRpb24gPSB0aGlzLnVwZGF0ZURlcGVuZGVuY3lMaW5lcyhvcmlnaW5hbENvbmZpZ3VyYXRpb24sIGFkZGl0aW9uYWxBcHBEZXBlbmRlbmNpZXMpO1xuICAgIGF3YWl0IGZzLndyaXRlRmlsZShidWlsZFBhdGgsIG5ld0NvbmZpZ3VyYXRpb24sICd1dGY4Jyk7XG4gIH1cblxuICB1cGRhdGVEZXBlbmRlbmN5TGluZXMgKGNvbmZpZ3VyYXRpb25Db250ZW50LCBhZGRpdGlvbmFsQXBwRGVwZW5kZW5jaWVzKSB7XG4gICAgY29uc3QgZGVwZW5kZW5jeUxpbmVzID0gYWRkaXRpb25hbEFwcERlcGVuZGVuY2llc1xuICAgICAgLm1hcChmdW5jdGlvbiAoZGVwZW5kZW5jeSkge1xuICAgICAgICAvLyBEaXNhbGxvdyB3aGl0ZXNwYWNlIGFuZCBxdW90ZSBjaGFyYWN0ZXJzIHRoYXQgY2FuIGJyZWFrIHN0cmluZyBsaXRlcmFscyBpbiBhIHBhdGNoZWQgYnVpbGQuZ3JhZGxlXG4gICAgICAgIC8vIGFuZCBkb2xsYXIgY2hhcmFjdGVycyB0aGF0IG90aGVyd2lzZSB3b3VsZCBiZSBpbnRlcnByZXRlZCBieSBTdHJpbmcucmVwbGFjZSBiZWxvd1xuICAgICAgICBpZiAoL1tcXHMnXFxcXCRdLy50ZXN0KGRlcGVuZGVuY3kpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaW5nbGUgcXVvdGVzLCBkb2xsYXIgY2hhcmFjdGVycyBhbmQgd2hpdGVzcGFjZSBjaGFyYWN0ZXJzJyArXG4gICAgICAgICAgICBgIGFyZSBkaXNhbGxvd2VkIGluIGFkZGl0aW9uYWwgZGVwZW5kZW5jaWVzOiAke2RlcGVuZGVuY3l9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGBpbXBsZW1lbnRhdGlvbiAnJHtkZXBlbmRlbmN5fSdgO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCckMScpOyAvLyBpbnRlcnByZXRlZCBhcyBHcm91cCAxIGZyb20gdGhlIHBhdHRlcm4gYmVsb3dcblxuICAgIHJldHVybiBjb25maWd1cmF0aW9uQ29udGVudC5yZXBsYWNlKFxuICAgICAgLy8gR3JvdXAgMSBjYXB0dXJlcyBuZXcgbGluZSBjaGFyYWN0ZXJzIGFuZCBpbmRlbnRhdGlvbiAoZWcuICdcXG5cXHQnKSB1c2VkIGluIGJ1aWxkLmdyYWRsZSBmaWxlXG4gICAgICAvLyBUaGlzIGVuc3VyZXMgdGhhdCBhIHBhdGNoZWQgYnVpbGQuZ3JhZGxlIHdpbGwgaGF2ZSBjb3JyZWN0IG5ldyBsaW5lcyBhbmQgaW5kZW50YXRpb25cbiAgICAgIG5ldyBSZWdFeHAoYChcXFxccypeXFxcXHMqKSR7Xy5lc2NhcGVSZWdFeHAoR1JBRExFX0RFUEVOREVOQ0lFU19QTEFDRUhPTERFUil9XFxcXHMqJGAsICdnbScpLFxuICAgICAgYCQxJHtkZXBlbmRlbmN5TGluZXN9YFxuICAgICk7XG4gIH1cblxuICBhc3luYyBydW5CdWlsZFByb2Nlc3MgKCkge1xuICAgIGNvbnN0IHtjbWQsIGFyZ3N9ID0gdGhpcy5nZXRDb21tYW5kKCk7XG4gICAgbG9nLmRlYnVnKGBCZWdpbm5pbmcgYnVpbGQgd2l0aCBjb21tYW5kICcke2NtZH0gJHthcmdzLmpvaW4oJyAnKX0nIGAgK1xuICAgICAgYGluIGRpcmVjdG9yeSAnJHt0aGlzLnNlcnZlclBhdGh9J2ApO1xuICAgIGNvbnN0IGdyYWRsZWJ1aWxkID0gbmV3IFN1YlByb2Nlc3MoY21kLCBhcmdzLCB7XG4gICAgICBjd2Q6IHRoaXMuc2VydmVyUGF0aCxcbiAgICAgIHN0ZGlvOiBbJ2lnbm9yZScsICdwaXBlJywgJ3BpcGUnXSxcbiAgICB9KTtcbiAgICBsZXQgYnVpbGRMYXN0TGluZXMgPSBbXTtcblxuICAgIGNvbnN0IGxvZ01zZyA9IGBPdXRwdXQgZnJvbSBHcmFkbGUgJHt0aGlzLnNob3dHcmFkbGVMb2cgPyAnd2lsbCcgOiAnd2lsbCBub3QnfSBiZSBsb2dnZWRgO1xuICAgIGxvZy5kZWJ1ZyhgJHtsb2dNc2d9LiBUbyBjaGFuZ2UgdGhpcywgdXNlICdzaG93R3JhZGxlTG9nJyBkZXNpcmVkIGNhcGFiaWxpdHlgKTtcbiAgICBncmFkbGVidWlsZC5vbignc3RyZWFtLWxpbmUnLCAobGluZSkgPT4ge1xuICAgICAgaWYgKHRoaXMuc2hvd0dyYWRsZUxvZykge1xuICAgICAgICBpZiAobGluZS5zdGFydHNXaXRoKCdbU1RERVJSXScpKSB7XG4gICAgICAgICAgZ3JhZGxlTG9nLndhcm4obGluZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ3JhZGxlTG9nLmluZm8obGluZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGJ1aWxkTGFzdExpbmVzLnB1c2goYCR7RU9MfSR7bGluZX1gKTtcbiAgICAgIGlmIChidWlsZExhc3RMaW5lcy5sZW5ndGggPiBHUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUykge1xuICAgICAgICBidWlsZExhc3RMaW5lcyA9IGJ1aWxkTGFzdExpbmVzLnNsaWNlKC1HUkFETEVfTUFYX0VSUk9SX0xPR19MSU5FUyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgZ3JhZGxlYnVpbGQuc3RhcnQoKTtcbiAgICAgIGF3YWl0IGdyYWRsZWJ1aWxkLmpvaW4oKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxldCBtc2cgPSBgVW5hYmxlIHRvIGJ1aWxkIEVzcHJlc3NvIHNlcnZlciAtICR7ZXJyLm1lc3NhZ2V9XFxuYCArXG4gICAgICAgIGBHcmFkbGUgZXJyb3IgbWVzc2FnZToke0VPTH0ke2J1aWxkTGFzdExpbmVzfWA7XG4gICAgICBsb2cuZXJyb3JBbmRUaHJvdyhtc2cpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBTZXJ2ZXJCdWlsZGVyLCBWRVJTSU9OX0tFWVMsIEdSQURMRV9VUkxfVEVNUExBVEUsIEdSQURMRV9ERVBFTkRFTkNJRVNfUExBQ0VIT0xERVIsIGJ1aWxkU2VydmVyU2lnbmluZ0NvbmZpZyB9O1xuZXhwb3J0IGRlZmF1bHQgU2VydmVyQnVpbGRlcjtcbiJdLCJmaWxlIjoibGliL3NlcnZlci1idWlsZGVyLmpzIiwic291cmNlUm9vdCI6Ii4uLy4uIn0=
