"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.OptionalLyftCommandCheck = exports.OptionalIOSDeployCommandCheck = exports.OptionalApplesimutilsCommandCheck = exports.OptionalIdbCommandCheck = exports.CarthageCheck = exports.AuthorizationDbCheck = exports.DevToolsSecurityCheck = exports.XcodeCmdLineToolsCheck = exports.XcodeCheck = exports.fixes = void 0;

require("source-map-support/register");

var _utils = require("./utils");

var _appiumSupport = require("appium-support");

var _teen_process = require("teen_process");

var _doctor = require("./doctor");

var _logger = _interopRequireDefault(require("./logger"));

var _carthageDetector = _interopRequireDefault(require("./carthage-detector"));

var _prompt = require("./prompt");

var _env = _interopRequireDefault(require("./env"));

var _lodash = _interopRequireDefault(require("lodash"));

require("colors");

let checks = [];
let fixes = {};
exports.fixes = fixes;

class XcodeCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let xcodePath;

    try {
      await (0, _teen_process.exec)('xcrun', ['simctl', 'help']);
    } catch (err) {
      return (0, _utils.nok)('Error running xcrun simctl');
    }

    try {
      const {
        stdout
      } = await (0, _teen_process.exec)('xcode-select', ['-p']);
      xcodePath = (stdout || '').replace('\n', '');
    } catch (err) {
      return (0, _utils.nok)('Xcode is NOT installed!');
    }

    return xcodePath && (await _appiumSupport.fs.exists(xcodePath)) ? (0, _utils.ok)(`Xcode is installed at: ${xcodePath}`) : (0, _utils.nok)(`Xcode cannot be found at '${xcodePath}'!`);
  }

  async fix() {
    return `Manually install ${'Xcode'.bold}, and make sure 'xcode-select -p' command shows proper path like '/Applications/Xcode.app/Contents/Developer'`;
  }

}

exports.XcodeCheck = XcodeCheck;
checks.push(new XcodeCheck());

class XcodeCmdLineToolsCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const errMess = 'Xcode Command Line Tools are NOT installed!';

    try {
      const stdout = (await (0, _teen_process.exec)('xcode-select', ['-p'])).stdout;
      return (0, _utils.ok)(`Xcode Command Line Tools are installed in: ${stdout.trim()}`);
    } catch (err) {
      _logger.default.debug(err);

      return (0, _utils.nok)(errMess);
    }
  }

  async fix() {
    _logger.default.info(`The following command need be executed: xcode-select --install`);

    let yesno = await (0, _prompt.fixIt)();

    if (yesno === 'yes') {
      await (0, _teen_process.exec)('xcode-select', ['--install']);
    } else {
      _logger.default.info(`Skipping you will need to install ${'Xcode'.bold} manually.`);

      throw new _doctor.FixSkippedError();
    }
  }

}

exports.XcodeCmdLineToolsCheck = XcodeCmdLineToolsCheck;
checks.push(new XcodeCmdLineToolsCheck());

fixes.authorizeIosFix = async function () {
  _logger.default.info(`The authorize iOS script need to be run.`);

  let yesno = await (0, _prompt.fixIt)();

  if (yesno === 'yes') {
    await (0, _utils.authorizeIos)();
  } else {
    _logger.default.info(`Skipping you will need to run ${'the authorize iOS'.bold} manually.`);

    throw new _doctor.FixSkippedError();
  }
};

class DevToolsSecurityCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const errMess = 'DevToolsSecurity is NOT enabled!';
    let stdout;

    try {
      stdout = (await (0, _teen_process.exec)('DevToolsSecurity', [])).stdout;
    } catch (err) {
      _logger.default.debug(err);

      return (0, _utils.nok)(errMess);
    }

    return stdout && stdout.match(/enabled/) ? (0, _utils.ok)('DevToolsSecurity is enabled.') : (0, _utils.nok)(errMess);
  }

  async fix() {
    return await fixes.authorizeIosFix();
  }

}

exports.DevToolsSecurityCheck = DevToolsSecurityCheck;
checks.push(new DevToolsSecurityCheck());

class AuthorizationDbCheck extends _doctor.DoctorCheck {
  constructor() {
    super({
      autofix: true
    });
  }

  async diagnose() {
    const successMess = 'The Authorization DB is set up properly.';
    const errMess = 'The Authorization DB is NOT set up properly.';
    let stdout;

    try {
      ({
        stdout
      } = await (0, _teen_process.exec)('security', ['authorizationdb', 'read', 'system.privilege.taskport']));
    } catch (err) {
      _logger.default.warn(err);

      return (0, _utils.nok)(errMess);
    }

    return stdout && (stdout.match(/is-developer/) || stdout.match(/allow/)) ? (0, _utils.ok)(successMess) : (0, _utils.nok)(errMess);
  }

  async fix() {
    return await fixes.authorizeIosFix();
  }

}

exports.AuthorizationDbCheck = AuthorizationDbCheck;
checks.push(new AuthorizationDbCheck());

class CarthageCheck extends _doctor.DoctorCheck {
  async diagnose() {
    let carthagePath = await _carthageDetector.default.detect();
    let version;

    if (carthagePath) {
      try {
        const {
          stdout
        } = await (0, _teen_process.exec)(carthagePath, ['version']);
        version = _lodash.default.last(stdout.match(/(\d+\.\d+\.\d+)/g));

        if (!_appiumSupport.util.coerceVersion(version, false)) {
          _logger.default.warn(`Cannot parse Carthage version from ${stdout}`);
        }
      } catch (err) {
        _logger.default.warn(err);
      }
    }

    return carthagePath ? (0, _utils.ok)(`Carthage was found at: ${carthagePath}${version ? `. Installed version is: ${version}` : ''}`) : (0, _utils.nok)(`Carthage was NOT found!`);
  }

  async fix() {
    return `Please install ${'Carthage'.bold}. Visit https://github.com/Carthage` + '/Carthage#installing-carthage for more information.';
  }

}

exports.CarthageCheck = CarthageCheck;
checks.push(new CarthageCheck());
checks.push(new _env.default('HOME'));

class OptionalLyftCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const lyftCmd = await (0, _utils.resolveExecutablePath)('set-simulator-location');

    if (lyftCmd) {
      return (0, _utils.okOptional)('set-simulator-location is installed');
    }

    return (0, _utils.nokOptional)('set-simulator-location is not installed');
  }

  async fix() {
    return `${'set-simulator-location'.bold} is needed to set location for Simulator. ` + 'Please real https://github.com/lyft/set-simulator-location to install it';
  }

}

exports.OptionalLyftCommandCheck = OptionalLyftCommandCheck;
checks.push(new OptionalLyftCommandCheck());

class OptionalIdbCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const fbIdbPath = await (0, _utils.resolveExecutablePath)('idb');
    const fbCompanionIdbPath = await (0, _utils.resolveExecutablePath)('idb_companion');

    if (fbIdbPath && fbCompanionIdbPath) {
      return (0, _utils.okOptional)('idb and idb_companion are installed');
    }

    if (!fbIdbPath && fbCompanionIdbPath) {
      return (0, _utils.nokOptional)('idb is not installed');
    } else if (fbIdbPath && !fbCompanionIdbPath) {
      return (0, _utils.nokOptional)('idb_companion is not installed');
    }

    return (0, _utils.nokOptional)('idb and idb_companion are not installed');
  }

  async fix() {
    return `Why ${'idb'.bold} is needed and how to install it: https://github.com/appium/appium-idb`;
  }

}

exports.OptionalIdbCommandCheck = OptionalIdbCommandCheck;
checks.push(new OptionalIdbCommandCheck());

class OptionalApplesimutilsCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const applesimutilsPath = await (0, _utils.resolveExecutablePath)('applesimutils');
    return applesimutilsPath ? (0, _utils.okOptional)(`applesimutils is installed at: ${applesimutilsPath}. Installed versions are: ${(await (0, _teen_process.exec)('brew', ['list', '--versions', 'applesimutils'])).stdout.trim()}`) : (0, _utils.nokOptional)('applesimutils cannot be found');
  }

  async fix() {
    return `Why ${'applesimutils'.bold} is needed and how to install it: http://appium.io/docs/en/drivers/ios-xcuitest/`;
  }

}

exports.OptionalApplesimutilsCommandCheck = OptionalApplesimutilsCommandCheck;
checks.push(new OptionalApplesimutilsCommandCheck());

class OptionalIOSDeployCommandCheck extends _doctor.DoctorCheck {
  async diagnose() {
    const iosDeployPath = await (0, _utils.resolveExecutablePath)('ios-deploy');
    return iosDeployPath ? (0, _utils.okOptional)(`ios-deploy is installed at: ${iosDeployPath}. Installed version is: ${(await (0, _teen_process.exec)(iosDeployPath, ['-V'])).stdout.trim()}`) : (0, _utils.nokOptional)('ios-deploy cannot be found');
  }

  async fix() {
    return `${'ios-deploy'.bold} is used as a fallback command to install iOS applications to real device. Please read https://github.com/ios-control/ios-deploy/ to install it`;
  }

}

exports.OptionalIOSDeployCommandCheck = OptionalIOSDeployCommandCheck;
checks.push(new OptionalIOSDeployCommandCheck());
var _default = checks;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9pb3MuanMiXSwibmFtZXMiOlsiY2hlY2tzIiwiZml4ZXMiLCJYY29kZUNoZWNrIiwiRG9jdG9yQ2hlY2siLCJkaWFnbm9zZSIsInhjb2RlUGF0aCIsImVyciIsInN0ZG91dCIsInJlcGxhY2UiLCJmcyIsImV4aXN0cyIsImZpeCIsImJvbGQiLCJwdXNoIiwiWGNvZGVDbWRMaW5lVG9vbHNDaGVjayIsImNvbnN0cnVjdG9yIiwiYXV0b2ZpeCIsImVyck1lc3MiLCJ0cmltIiwibG9nIiwiZGVidWciLCJpbmZvIiwieWVzbm8iLCJGaXhTa2lwcGVkRXJyb3IiLCJhdXRob3JpemVJb3NGaXgiLCJEZXZUb29sc1NlY3VyaXR5Q2hlY2siLCJtYXRjaCIsIkF1dGhvcml6YXRpb25EYkNoZWNrIiwic3VjY2Vzc01lc3MiLCJ3YXJuIiwiQ2FydGhhZ2VDaGVjayIsImNhcnRoYWdlUGF0aCIsIkNhcnRoYWdlRGV0ZWN0b3IiLCJkZXRlY3QiLCJ2ZXJzaW9uIiwiXyIsImxhc3QiLCJ1dGlsIiwiY29lcmNlVmVyc2lvbiIsIkVudlZhckFuZFBhdGhDaGVjayIsIk9wdGlvbmFsTHlmdENvbW1hbmRDaGVjayIsImx5ZnRDbWQiLCJPcHRpb25hbElkYkNvbW1hbmRDaGVjayIsImZiSWRiUGF0aCIsImZiQ29tcGFuaW9uSWRiUGF0aCIsIk9wdGlvbmFsQXBwbGVzaW11dGlsc0NvbW1hbmRDaGVjayIsImFwcGxlc2ltdXRpbHNQYXRoIiwiT3B0aW9uYWxJT1NEZXBsb3lDb21tYW5kQ2hlY2siLCJpb3NEZXBsb3lQYXRoIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLElBQUlBLE1BQU0sR0FBRyxFQUFiO0FBQ0EsSUFBSUMsS0FBSyxHQUFHLEVBQVo7OztBQUdBLE1BQU1DLFVBQU4sU0FBeUJDLG1CQUF6QixDQUFxQztBQUNuQyxRQUFNQyxRQUFOLEdBQWtC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bXBvcnQgeyBvaywgbm9rLCBva09wdGlvbmFsLCBub2tPcHRpb25hbCwgYXV0aG9yaXplSW9zLCByZXNvbHZlRXhlY3V0YWJsZVBhdGggfSBmcm9tICcuL3V0aWxzJzsgLy8gZXNsaW50LWRpc2FibGUtbGluZVxuaW1wb3J0IHsgZnMsIHV0aWwgfSBmcm9tICdhcHBpdW0tc3VwcG9ydCc7XG5pbXBvcnQgeyBleGVjIH0gZnJvbSAndGVlbl9wcm9jZXNzJztcbmltcG9ydCB7IERvY3RvckNoZWNrLCBGaXhTa2lwcGVkRXJyb3IgfSBmcm9tICcuL2RvY3Rvcic7XG5pbXBvcnQgbG9nIGZyb20gJy4vbG9nZ2VyJztcbmltcG9ydCBDYXJ0aGFnZURldGVjdG9yIGZyb20gJy4vY2FydGhhZ2UtZGV0ZWN0b3InO1xuaW1wb3J0IHsgZml4SXQgfSBmcm9tICcuL3Byb21wdCc7XG5pbXBvcnQgRW52VmFyQW5kUGF0aENoZWNrIGZyb20gJy4vZW52JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgJ2NvbG9ycyc7XG5cbmxldCBjaGVja3MgPSBbXTtcbmxldCBmaXhlcyA9IHt9O1xuXG4vLyBDaGVjayBmb3IgWGNvZGUuXG5jbGFzcyBYY29kZUNoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgbGV0IHhjb2RlUGF0aDtcbiAgICB0cnkge1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0vaXNzdWVzLzEyMDkzI2lzc3VlY29tbWVudC00NTkzNTgxMjAgY2FuIGhhcHBlblxuICAgICAgYXdhaXQgZXhlYygneGNydW4nLCBbJ3NpbWN0bCcsICdoZWxwJ10pO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIG5vaygnRXJyb3IgcnVubmluZyB4Y3J1biBzaW1jdGwnKTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHtzdGRvdXR9ID0gYXdhaXQgZXhlYygneGNvZGUtc2VsZWN0JywgWyctcCddKTtcbiAgICAgIHhjb2RlUGF0aCA9IChzdGRvdXQgfHwgJycpLnJlcGxhY2UoJ1xcbicsICcnKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiBub2soJ1hjb2RlIGlzIE5PVCBpbnN0YWxsZWQhJyk7XG4gICAgfVxuICAgIHJldHVybiB4Y29kZVBhdGggJiYgYXdhaXQgZnMuZXhpc3RzKHhjb2RlUGF0aCkgPyBvayhgWGNvZGUgaXMgaW5zdGFsbGVkIGF0OiAke3hjb2RlUGF0aH1gKSA6XG4gICAgICBub2soYFhjb2RlIGNhbm5vdCBiZSBmb3VuZCBhdCAnJHt4Y29kZVBhdGh9JyFgKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgTWFudWFsbHkgaW5zdGFsbCAkeydYY29kZScuYm9sZH0sIGFuZCBtYWtlIHN1cmUgJ3hjb2RlLXNlbGVjdCAtcCcgY29tbWFuZCBzaG93cyBwcm9wZXIgcGF0aCBsaWtlICcvQXBwbGljYXRpb25zL1hjb2RlLmFwcC9Db250ZW50cy9EZXZlbG9wZXInYDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IFhjb2RlQ2hlY2soKSk7XG5cbi8vIENoZWNrIGZvciBYY29kZSBDb21tYW5kIExpbmUgVG9vbHMuXG5jbGFzcyBYY29kZUNtZExpbmVUb29sc0NoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgc3VwZXIoe2F1dG9maXg6IHRydWV9KTtcbiAgfVxuXG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBlcnJNZXNzID0gJ1hjb2RlIENvbW1hbmQgTGluZSBUb29scyBhcmUgTk9UIGluc3RhbGxlZCEnO1xuICAgIHRyeSB7XG4gICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNTM3MTkyNS9ob3ctdG8tY2hlY2staWYtY29tbWFuZC1saW5lLXRvb2xzLWlzLWluc3RhbGxlZFxuICAgICAgY29uc3Qgc3Rkb3V0ID0gKGF3YWl0IGV4ZWMoJ3hjb2RlLXNlbGVjdCcsIFsnLXAnXSkpLnN0ZG91dDtcbiAgICAgIHJldHVybiBvayhgWGNvZGUgQ29tbWFuZCBMaW5lIFRvb2xzIGFyZSBpbnN0YWxsZWQgaW46ICR7c3Rkb3V0LnRyaW0oKX1gKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhlcnIpO1xuICAgICAgcmV0dXJuIG5vayhlcnJNZXNzKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmaXggKCkge1xuICAgIGxvZy5pbmZvKGBUaGUgZm9sbG93aW5nIGNvbW1hbmQgbmVlZCBiZSBleGVjdXRlZDogeGNvZGUtc2VsZWN0IC0taW5zdGFsbGApO1xuICAgIGxldCB5ZXNubyA9IGF3YWl0IGZpeEl0KCk7XG4gICAgaWYgKHllc25vID09PSAneWVzJykge1xuICAgICAgYXdhaXQgZXhlYygneGNvZGUtc2VsZWN0JywgWyctLWluc3RhbGwnXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvZy5pbmZvKGBTa2lwcGluZyB5b3Ugd2lsbCBuZWVkIHRvIGluc3RhbGwgJHsnWGNvZGUnLmJvbGR9IG1hbnVhbGx5LmApO1xuICAgICAgdGhyb3cgbmV3IEZpeFNraXBwZWRFcnJvcigpO1xuICAgIH1cbiAgfVxufVxuXG5jaGVja3MucHVzaChuZXcgWGNvZGVDbWRMaW5lVG9vbHNDaGVjaygpKTtcblxuLy8gQXV0b21hdGljYWxseSBydW4gYXV0aG9yaXplIGlPUyBpZiByZXF1ZXN0ZWRcbmZpeGVzLmF1dGhvcml6ZUlvc0ZpeCA9IGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgbG9nLmluZm8oYFRoZSBhdXRob3JpemUgaU9TIHNjcmlwdCBuZWVkIHRvIGJlIHJ1bi5gKTtcbiAgbGV0IHllc25vID0gYXdhaXQgZml4SXQoKTtcbiAgaWYgKHllc25vID09PSAneWVzJykge1xuICAgIGF3YWl0IGF1dGhvcml6ZUlvcygpO1xuICB9IGVsc2Uge1xuICAgIGxvZy5pbmZvKGBTa2lwcGluZyB5b3Ugd2lsbCBuZWVkIHRvIHJ1biAkeyd0aGUgYXV0aG9yaXplIGlPUycuYm9sZH0gbWFudWFsbHkuYCk7XG4gICAgdGhyb3cgbmV3IEZpeFNraXBwZWRFcnJvcigpO1xuICB9XG59O1xuXG4vLyBEZXYgVG9vbHMgU2VjdXJpdHlcbmNsYXNzIERldlRvb2xzU2VjdXJpdHlDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHthdXRvZml4OiB0cnVlfSk7XG4gIH1cblxuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgZXJyTWVzcyA9ICdEZXZUb29sc1NlY3VyaXR5IGlzIE5PVCBlbmFibGVkISc7XG4gICAgbGV0IHN0ZG91dDtcbiAgICB0cnkge1xuICAgICAgc3Rkb3V0ID0gKGF3YWl0IGV4ZWMoJ0RldlRvb2xzU2VjdXJpdHknLCBbXSkpLnN0ZG91dDtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZy5kZWJ1ZyhlcnIpO1xuICAgICAgcmV0dXJuIG5vayhlcnJNZXNzKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0ZG91dCAmJiBzdGRvdXQubWF0Y2goL2VuYWJsZWQvKSA/IG9rKCdEZXZUb29sc1NlY3VyaXR5IGlzIGVuYWJsZWQuJylcbiAgICAgIDogbm9rKGVyck1lc3MpO1xuICB9XG4gIGFzeW5jIGZpeCAoKSB7XG4gICAgcmV0dXJuIGF3YWl0IGZpeGVzLmF1dGhvcml6ZUlvc0ZpeCgpO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgRGV2VG9vbHNTZWN1cml0eUNoZWNrKCkpO1xuXG4vLyBBdXRob3JpemF0aW9uIERCXG5jbGFzcyBBdXRob3JpemF0aW9uRGJDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgY29uc3RydWN0b3IgKCkge1xuICAgIHN1cGVyKHthdXRvZml4OiB0cnVlfSk7XG4gIH1cblxuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3Qgc3VjY2Vzc01lc3MgPSAnVGhlIEF1dGhvcml6YXRpb24gREIgaXMgc2V0IHVwIHByb3Blcmx5Lic7XG4gICAgY29uc3QgZXJyTWVzcyA9ICdUaGUgQXV0aG9yaXphdGlvbiBEQiBpcyBOT1Qgc2V0IHVwIHByb3Blcmx5Lic7XG4gICAgbGV0IHN0ZG91dDtcbiAgICB0cnkge1xuICAgICAgKHtzdGRvdXR9ID0gYXdhaXQgZXhlYygnc2VjdXJpdHknLCBbJ2F1dGhvcml6YXRpb25kYicsICdyZWFkJywgJ3N5c3RlbS5wcml2aWxlZ2UudGFza3BvcnQnXSkpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nLndhcm4oZXJyKTtcbiAgICAgIHJldHVybiBub2soZXJyTWVzcyk7XG4gICAgfVxuICAgIHJldHVybiBzdGRvdXQgJiYgKHN0ZG91dC5tYXRjaCgvaXMtZGV2ZWxvcGVyLykgfHwgc3Rkb3V0Lm1hdGNoKC9hbGxvdy8pKSA/XG4gICAgICBvayhzdWNjZXNzTWVzcykgOiBub2soZXJyTWVzcyk7XG4gIH1cbiAgYXN5bmMgZml4ICgpIHtcbiAgICByZXR1cm4gYXdhaXQgZml4ZXMuYXV0aG9yaXplSW9zRml4KCk7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBBdXRob3JpemF0aW9uRGJDaGVjaygpKTtcblxuLy8gQ2hlY2sgZm9yIENhcnRoYWdlIChmb3IgV0RBKVxuY2xhc3MgQ2FydGhhZ2VDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGxldCBjYXJ0aGFnZVBhdGggPSBhd2FpdCBDYXJ0aGFnZURldGVjdG9yLmRldGVjdCgpO1xuXG4gICAgbGV0IHZlcnNpb247XG4gICAgaWYgKGNhcnRoYWdlUGF0aCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKGNhcnRoYWdlUGF0aCwgWyd2ZXJzaW9uJ10pO1xuICAgICAgICAvLyAnUGxlYXNlIHVwZGF0ZSB0byB0aGUgbGF0ZXN0IENhcnRoYWdlIHZlcnNpb246IDAuMzMuMC4gWW91IGN1cnJlbnRseSBhcmUgb24gMC4zMi4wXFxuMC4zMi4wXFxuJyBvciAnMC4zMi4wXFxuJ1xuICAgICAgICAvLyAwLjMyLjAgaXMgdGhlIGN1cnJlbnQgdmVyc2lvbi4gMC4zMy4wIGlzIGFuIGF2YWlsYWJsZSBuZXdlciB2ZXJzaW9uLlxuICAgICAgICB2ZXJzaW9uID0gXy5sYXN0KHN0ZG91dC5tYXRjaCgvKFxcZCtcXC5cXGQrXFwuXFxkKykvZykpO1xuICAgICAgICBpZiAoIXV0aWwuY29lcmNlVmVyc2lvbih2ZXJzaW9uLCBmYWxzZSkpIHtcbiAgICAgICAgICBsb2cud2FybihgQ2Fubm90IHBhcnNlIENhcnRoYWdlIHZlcnNpb24gZnJvbSAke3N0ZG91dH1gKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZy53YXJuKGVycik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNhcnRoYWdlUGF0aFxuICAgICAgPyBvayhgQ2FydGhhZ2Ugd2FzIGZvdW5kIGF0OiAke2NhcnRoYWdlUGF0aH0keyB2ZXJzaW9uID8gYC4gSW5zdGFsbGVkIHZlcnNpb24gaXM6ICR7dmVyc2lvbn1gIDogJyd9YClcbiAgICAgIDogbm9rKGBDYXJ0aGFnZSB3YXMgTk9UIGZvdW5kIWApO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGBQbGVhc2UgaW5zdGFsbCAkeydDYXJ0aGFnZScuYm9sZH0uIFZpc2l0IGh0dHBzOi8vZ2l0aHViLmNvbS9DYXJ0aGFnZWAgK1xuICAgICAgICAgICAnL0NhcnRoYWdlI2luc3RhbGxpbmctY2FydGhhZ2UgZm9yIG1vcmUgaW5mb3JtYXRpb24uJztcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IENhcnRoYWdlQ2hlY2soKSk7XG5cbmNoZWNrcy5wdXNoKG5ldyBFbnZWYXJBbmRQYXRoQ2hlY2soJ0hPTUUnKSk7XG5cbmNsYXNzIE9wdGlvbmFsTHlmdENvbW1hbmRDaGVjayBleHRlbmRzIERvY3RvckNoZWNrIHtcbiAgYXN5bmMgZGlhZ25vc2UgKCkge1xuICAgIGNvbnN0IGx5ZnRDbWQgPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ3NldC1zaW11bGF0b3ItbG9jYXRpb24nKTtcbiAgICBpZiAobHlmdENtZCkge1xuICAgICAgcmV0dXJuIG9rT3B0aW9uYWwoJ3NldC1zaW11bGF0b3ItbG9jYXRpb24gaXMgaW5zdGFsbGVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5va09wdGlvbmFsKCdzZXQtc2ltdWxhdG9yLWxvY2F0aW9uIGlzIG5vdCBpbnN0YWxsZWQnKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgJHsnc2V0LXNpbXVsYXRvci1sb2NhdGlvbicuYm9sZH0gaXMgbmVlZGVkIHRvIHNldCBsb2NhdGlvbiBmb3IgU2ltdWxhdG9yLiBgICtcbiAgICAgICdQbGVhc2UgcmVhbCBodHRwczovL2dpdGh1Yi5jb20vbHlmdC9zZXQtc2ltdWxhdG9yLWxvY2F0aW9uIHRvIGluc3RhbGwgaXQnO1xuICB9XG59XG5jaGVja3MucHVzaChuZXcgT3B0aW9uYWxMeWZ0Q29tbWFuZENoZWNrKCkpO1xuXG5cbmNsYXNzIE9wdGlvbmFsSWRiQ29tbWFuZENoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgZmJJZGJQYXRoID0gYXdhaXQgcmVzb2x2ZUV4ZWN1dGFibGVQYXRoKCdpZGInKTtcbiAgICBjb25zdCBmYkNvbXBhbmlvbklkYlBhdGggPSBhd2FpdCByZXNvbHZlRXhlY3V0YWJsZVBhdGgoJ2lkYl9jb21wYW5pb24nKTtcbiAgICBpZiAoZmJJZGJQYXRoICYmIGZiQ29tcGFuaW9uSWRiUGF0aCkge1xuICAgICAgcmV0dXJuIG9rT3B0aW9uYWwoJ2lkYiBhbmQgaWRiX2NvbXBhbmlvbiBhcmUgaW5zdGFsbGVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCFmYklkYlBhdGggJiYgZmJDb21wYW5pb25JZGJQYXRoKSB7XG4gICAgICByZXR1cm4gbm9rT3B0aW9uYWwoJ2lkYiBpcyBub3QgaW5zdGFsbGVkJyk7XG4gICAgfSBlbHNlIGlmIChmYklkYlBhdGggJiYgIWZiQ29tcGFuaW9uSWRiUGF0aCkge1xuICAgICAgcmV0dXJuIG5va09wdGlvbmFsKCdpZGJfY29tcGFuaW9uIGlzIG5vdCBpbnN0YWxsZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIG5va09wdGlvbmFsKCdpZGIgYW5kIGlkYl9jb21wYW5pb24gYXJlIG5vdCBpbnN0YWxsZWQnKTtcbiAgfVxuXG4gIGFzeW5jIGZpeCAoKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgcmVxdWlyZS1hd2FpdFxuICAgIHJldHVybiBgV2h5ICR7J2lkYicuYm9sZH0gaXMgbmVlZGVkIGFuZCBob3cgdG8gaW5zdGFsbCBpdDogaHR0cHM6Ly9naXRodWIuY29tL2FwcGl1bS9hcHBpdW0taWRiYDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsSWRiQ29tbWFuZENoZWNrKCkpO1xuXG5jbGFzcyBPcHRpb25hbEFwcGxlc2ltdXRpbHNDb21tYW5kQ2hlY2sgZXh0ZW5kcyBEb2N0b3JDaGVjayB7XG4gIGFzeW5jIGRpYWdub3NlICgpIHtcbiAgICBjb25zdCBhcHBsZXNpbXV0aWxzUGF0aCA9IGF3YWl0IHJlc29sdmVFeGVjdXRhYmxlUGF0aCgnYXBwbGVzaW11dGlscycpO1xuICAgIHJldHVybiBhcHBsZXNpbXV0aWxzUGF0aFxuICAgICAgPyBva09wdGlvbmFsKGBhcHBsZXNpbXV0aWxzIGlzIGluc3RhbGxlZCBhdDogJHthcHBsZXNpbXV0aWxzUGF0aH0uIEluc3RhbGxlZCB2ZXJzaW9ucyBhcmU6ICR7KGF3YWl0IGV4ZWMoJ2JyZXcnLCBbJ2xpc3QnLCAnLS12ZXJzaW9ucycsICdhcHBsZXNpbXV0aWxzJ10pKS5zdGRvdXQudHJpbSgpfWApXG4gICAgICA6IG5va09wdGlvbmFsKCdhcHBsZXNpbXV0aWxzIGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGBXaHkgJHsnYXBwbGVzaW11dGlscycuYm9sZH0gaXMgbmVlZGVkIGFuZCBob3cgdG8gaW5zdGFsbCBpdDogaHR0cDovL2FwcGl1bS5pby9kb2NzL2VuL2RyaXZlcnMvaW9zLXhjdWl0ZXN0L2A7XG4gIH1cbn1cbmNoZWNrcy5wdXNoKG5ldyBPcHRpb25hbEFwcGxlc2ltdXRpbHNDb21tYW5kQ2hlY2soKSk7XG5cbmNsYXNzIE9wdGlvbmFsSU9TRGVwbG95Q29tbWFuZENoZWNrIGV4dGVuZHMgRG9jdG9yQ2hlY2sge1xuICBhc3luYyBkaWFnbm9zZSAoKSB7XG4gICAgY29uc3QgaW9zRGVwbG95UGF0aCA9IGF3YWl0IHJlc29sdmVFeGVjdXRhYmxlUGF0aCgnaW9zLWRlcGxveScpO1xuICAgIHJldHVybiBpb3NEZXBsb3lQYXRoXG4gICAgICA/IG9rT3B0aW9uYWwoYGlvcy1kZXBsb3kgaXMgaW5zdGFsbGVkIGF0OiAke2lvc0RlcGxveVBhdGh9LiBJbnN0YWxsZWQgdmVyc2lvbiBpczogJHsoYXdhaXQgZXhlYyhpb3NEZXBsb3lQYXRoLCBbJy1WJ10pKS5zdGRvdXQudHJpbSgpfWApXG4gICAgICA6IG5va09wdGlvbmFsKCdpb3MtZGVwbG95IGNhbm5vdCBiZSBmb3VuZCcpO1xuICB9XG5cbiAgYXN5bmMgZml4ICgpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSByZXF1aXJlLWF3YWl0XG4gICAgcmV0dXJuIGAkeydpb3MtZGVwbG95Jy5ib2xkfSBpcyB1c2VkIGFzIGEgZmFsbGJhY2sgY29tbWFuZCB0byBpbnN0YWxsIGlPUyBhcHBsaWNhdGlvbnMgdG8gcmVhbCBkZXZpY2UuIFBsZWFzZSByZWFkIGh0dHBzOi8vZ2l0aHViLmNvbS9pb3MtY29udHJvbC9pb3MtZGVwbG95LyB0byBpbnN0YWxsIGl0YDtcbiAgfVxufVxuY2hlY2tzLnB1c2gobmV3IE9wdGlvbmFsSU9TRGVwbG95Q29tbWFuZENoZWNrKCkpO1xuXG5leHBvcnQge1xuICBmaXhlcywgWGNvZGVDaGVjaywgWGNvZGVDbWRMaW5lVG9vbHNDaGVjaywgRGV2VG9vbHNTZWN1cml0eUNoZWNrLFxuICBBdXRob3JpemF0aW9uRGJDaGVjaywgQ2FydGhhZ2VDaGVjaywgT3B0aW9uYWxJZGJDb21tYW5kQ2hlY2ssIE9wdGlvbmFsQXBwbGVzaW11dGlsc0NvbW1hbmRDaGVjayxcbiAgT3B0aW9uYWxJT1NEZXBsb3lDb21tYW5kQ2hlY2ssIE9wdGlvbmFsTHlmdENvbW1hbmRDaGVja1xufTtcbmV4cG9ydCBkZWZhdWx0IGNoZWNrcztcbiJdLCJmaWxlIjoibGliL2lvcy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
